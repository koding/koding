# author: devrim@koding
# 1/7/2013
# update: 6/22/2014

fs              = require 'fs'
{extend}        = require 'underscore'

do ->
    unless 'first' of Array.prototype
      Object.defineProperty Array.prototype, 'first',
        get : -> this[0]
    unless 'last' of Array.prototype
      Object.defineProperty Array.prototype, 'last',
        get : -> this[this.length-1]


class Config
  @load: (name)->

    # DEPRECATION NOTICE. MAKE YOUR MODULES USE ./install/BUILD_CONFIG.json
    # code will assume correct config file is made available to them on build step.
    try
      cfg = JSON.parse process.env['KONFIG_JSON']
      cfg.getConfigScriptTag = (mixin={})->
        config = extend {}, @client.runtimeOptions, mixin
        """
        <script>var KD = #{JSON.stringify {config}};</script>
        """

      return cfg
    catch err
      console.log "COULDN'T FIND/PARSE env[KONFIG_JSON]"
      console.log "exiting now.",err
      process.exit()


  @printJson:(name)->
    console.log JSON.stringify @load name



module.exports = Config
