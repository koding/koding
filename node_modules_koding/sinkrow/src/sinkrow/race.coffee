class Race
  constructor:(@fn, @cb) ->
    @times = 0
    @finTimes = 0

  fin: =>
    if @times is ++@finTimes
      @cb? arguments...

  add:(args) ->
    i = @times++
    @fn [i].concat(args.concat @fin)...


module.exports = (fn, cb) ->
  race = new Race fn, cb
  (args...) ->
    race.add args
