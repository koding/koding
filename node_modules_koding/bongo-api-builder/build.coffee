Bongo = require 'bongo'

require 'colors'

module.exports = ({ modelsDir, rootDir, identifier, out }, callback) ->
  try
    eval "typeof #{ identifier }"
  catch
    throw new Error "Invalid identifier!"

  b = new Bongo
    root        : rootDir
    models      : modelsDir

  b.on 'apiReady', ->
    b.describeApi (api) ->
      source = "var #{ identifier } = #{ JSON.stringify api };"
      require('fs').writeFileSync out, source, 'utf-8'
      callback null
