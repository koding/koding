{ ObjectId } = require '../../'
mongo = require 'mongoskin'
deepCompare = require './deepcompare'

db = mongo.db('localhost/test')
log = console.log.bind(console)

v = { oid: new ObjectId }

v1 = v.oid

v2 = require('traverse').forEach v, (node) ->
  if node instanceof ObjectId
    console.log 'Found the object id', @path
    @update node, yes
  else
    @update node

v3 = require('traverse').map v, (node) ->
  if node instanceof ObjectId
    console.log 'Found the object id', @path
    @update node, yes
  else
    @update node

v4 = require('traverse').map v, (node) ->
  if node instanceof ObjectId
    @update ObjectId(node + ''), yes
  else
    @update node

log 'Comparing v and v2', deepCompare(v, v2)
log 'Comparing v and v2', deepCompare(v2, v3)
log 'Comparing v and v2', deepCompare(v, v3)

db.collection('foo').insert v1, { safe:yes }, log
db.collection('foo').insert v2, { safe:yes }, log
db.collection('foo').insert v3, { safe:yes }, log
db.collection('foo').insert v4, { safe:yes }, log
