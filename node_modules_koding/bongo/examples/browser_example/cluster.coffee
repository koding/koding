cluster = require('cluster')
http = require('http')
numCPUs = require('os').cpus().length
bongo = require('../../lib')

if cluster.isMaster
  i = 0

  while i < numCPUs
    cluster.fork()
    i++
  cluster.on 'death', (worker) ->
    console.log 'worker ' + worker.pid + ' died'
else

  { Model } = bongo

  class Foo extends Model
    @share()
    @set
      schema:
        foo : Number
        bar : String
        baz : Boolean
      sharedMethods:
        static: ['some']
        instance: ['save']

  server = http.Server (req, res) ->
    res.writeHead(200)
    res.end('hello world\n')
  server.listen(8000)

  bongo.listen server
