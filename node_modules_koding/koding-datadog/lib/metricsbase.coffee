DogStatsD = require './dogstatsd'

module.exports = class MetricsBase

  @sanitizeTagValue : (tagValue) ->

    tagValue = JSON.stringify tagValue  unless typeof tagValue is 'string'

    tagValue = tagValue.replace /[^A-Za-z0-9_]+/g, '_'

    return tagValue


  @sanitizeMetricName :(metricName) ->

    return metricName
      .replace /[:?]/g,               '_' # replace : and ? with _
      .replace /[^A-Za-z0-9_\.]+/g,   ''  # remove invalid characters


  @sendMetrics : (metricsList, metricName, tags) ->
    metricName = @sanitizeMetricName metricName

    dogStatsDClient = DogStatsD.getClient()

    for metricMethod, value of metricsList
      for metricSuffix, metricValue of metricsList[metricMethod]
        dogStatsDClient[metricMethod] "#{metricName}.#{metricSuffix}", metricValue, tags
