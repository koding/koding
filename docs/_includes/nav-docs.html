<script type="text/javascript">
  window.TERRAFORM_DOCS = [{% for p in site.pages %}{% if p.url contains "docs/terraform/" %}{ url: "{{ p.url }}", title: "{{ p.page_title }}", sidebar_current: "{{ p.sidebar_current }}"},{% endif %}{% endfor %}''];
  TERRAFORM_DOCS.pop();
  window.PAGE_URL = "{{ page.url }}";
</script>
<script type="text/javascript" src="{{ site.url }}/js/lodash.set.js"></script>
<aside>

  {% include docs-search.html %}

  <nav>
    {% for section in site.data.nav-docs %}
    <ul>
      <li>
        <a href='#' class="docs__section__topic">{{ section.title}}</a>
        <ul>
          {% for item in section.items %}
          {% assign url = "/docs/" | append: item.id %}
          <li{% if page.url == url %} class="active"{% endif %}><a href="{{ url }}">{{ item.title }}</a></li>
          {% endfor %}
        </ul>
      </li>
    </ul>
    {% endfor %}
    <ul id="terraform-docs"></ul>
  </nav>
</aside>

<script type="text/javascript" src="{{ site.url }}/js/nav-terraform.js"></script>
<script>

  var navDocs = {{ site.data.nav-docs | jsonify }}
  var results = null;

  var docsSearchEl = $('.docs__search');
  docsSearchEl.find('input')
    .blur(function() {
      if (results) results.remove();
    }).keyup(function() {
    var value = $.trim($(this).val());

    if (results) results.remove();
    docsSearchEl.append('<div class="docs__index__results"></div>');


    results = docsSearchEl.find('.docs__index__results');

    navDocs.forEach(function(doc) {

      var items = doc.items.filter(function(obj){
          return obj.title.toLowerCase().indexOf(value) != -1;
      })

      if (items.length) {

        results.append('<div class="docs__index__results__header">'+doc.title+'</div>');

        items.map(function(obj) {
            return "<div class='docs__index__results__row'><div class='results__row__title'>" + obj.title +"</div><div class='results__row__description'>The detail copy will be here.</div></div>";
        }).forEach(function(obj) {
          results.append(obj);
        })
      }
      //$('.docs_index__search__results').append()
    });
  })

  $('.navMenuSections').on('mouseover', 'a', function() {
    $('.navMenuSectionsSub ul').removeClass('active');
    $('.navMenuSectionsSub').find('#navmenu-' + $(this).attr('id')).addClass('active');
  });

</script>
