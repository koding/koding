{"resource":{"aws_instance":{"example-instance":{"ami":"ami-7c4b0a0b","instance_type":"t2.nano","key_name":"koding-deployment-alex-spb-1469099382204243656","security_groups":["sg-2d55124a","sg-2d55124a"],"subnet_id":"subnet-5dc10905","tags":[{"Name":"${var.koding_user_username}-${var.koding_group_slug}"},{"Name":"${var.koding_user_username}-${var.koding_group_slug}"}],"user_data":"\n#cloud-config\noutput : { all : '| tee -a /var/log/cloud-init-output.log' }\ndisable_root: false\ndisable_ec2_metadata: false\nhostname: 'alex'\n\nusers:\n  - default\n  - name: 'alex'\n    lock_passwd: True\n    gecos: Koding\n    groups: sudo\n    sudo: [\"ALL=(ALL) NOPASSWD:ALL\"]\n    shell: /bin/bash\n\n\n\nwrite_files:\n  # Create kite.key\n  - path: /etc/kite/kite.key\n    content: |\n      ${lookup(var.kitekeys_example-instance, count.index)}\n\n\n  # Create user script.\n  - path: /root/user-data.sh\n    encoding: b64\n    content: |\n      ${base64encode(null_resource.example-instance.triggers.user_data)}\n\n\n\n\nruncmd:\n  - [sh, -c, 'echo \"127.0.0.1 alex\" >> /etc/hosts']\n\n  # Install & Configure klient\n  - [wget, \"https://s3.amazonaws.com/koding-klient/development/latest/klient.deb\", --retry-connrefused, --tries, 5, -O, /tmp/latest-klient.deb]\n  - [dpkg, -i, /tmp/latest-klient.deb]\n  - [chown, -R, 'alex:alex', /opt/kite/klient]\n  - [service, klient, stop]\n  - [sed, -i, 's/\\.\\/klient/sudo -E -u alex \\.\\/klient/g', /etc/init/klient.conf]\n  - [service, klient, start]\n  - [rm, -f, /tmp/latest-klient.deb]\n\n\n\n\n  # Run user data script.\n  - [chmod, +x, /root/user-data.sh]\n  - [/root/user-data.sh]\n\n  - [echo, _KD_DONE_]\n\nfinal_message: \"All done!\"\n"}},"null_resource":{"example-instance":{"depends_on":[],"triggers":{"user_data":"#!/bin/sh\n# let's create a file on your root folder:\necho \"hello world!\" >> /helloworld.txt\n\n# please note: all commands under user_data will be run as root.\n# now add your credentials and save this stack.\n# once vm finishes building, you can see this file by typing\n# ls /\n#\n# for more information please click the link below \"Stack Script Docs\"\n"}}}},"provider":{"aws":{"access_key":"${var.aws_access_key}","region":"eu-west-1","secret_key":"${var.aws_secret_key}"}},"variable":{"aws_access_key":{"default":"AKIAJN676PJ7P2EYST7A"},"aws_acl":{"default":"acl-b61685d2"},"aws_ami":{"default":"ami-7c4b0a0b"},"aws_cidr_block":{"default":"10.0.0.0/16"},"aws_igw":{"default":"igw-a30831c6"},"aws_key_pair":{"default":"koding-deployment-alex-spb-1469099382204243656"},"aws_region":{"default":"eu-west-1"},"aws_rtb":{"default":"rtb-a55838c1"},"aws_secret_key":{"default":"UPi9Ulhce0TaAkqI4D9aHZCV1uFYSQSUkjaJrV/O"},"aws_sg":{"default":"sg-2d55124a"},"aws_subnet":{"default":"subnet-5dc10905"},"aws_vpc":{"default":"vpc-e2d17d86"},"kitekeys_example-instance":{"default":{"0":"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJiZGEzZDY4Mi02MWIzLTQyZDEtYmVmZC1iNzUyMjgxMGY0NDMiLCJpYXQiOjE0Njk2MDY5NDAsImlzcyI6ImtvZGluZyIsInN1YiI6ImFsZXgiLCJrb250cm9sS2V5IjoiLS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS1cbk1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBejA2SktqWmJ3Q3BraDRHMHJSdHJcblBoVnZWZ3g3aE5KNzlhUFhGaEVOdGk4dEs2cHdFU0dVUFBjcjhJZFkvWVYxZmZITVRjN2FSeWUrTDhFcUhlSDJcbkR2aGJqWUlCWHBpcmFxQTJreCtCUitxeDdYRTlqRDFSeHBaRjRid25DbThzdC90cVNoVXhsZDRvZk1BbW9RVFlcbnFOSjFMQXc1MWNCTmhIZG9YTVNwOWRsbkppMGVKTWpwVUhnQ281V2gwQXBDK1RSZDJkQ04rQzZlc2FvZFRETWJcblVPdURZaU1TZjYvbWRPN1NVRjh6VG9DeU1pY0pkVVlIcHpzcUUzTmo5QXNUd0ZYOERtczVxOVBNYWoxRlNRK1NcbjFuY283RVhFeHVtcHZFSXl0S2prRkZEU1J3c09SRUtJelUwZFNtZWlpaDZTVDBHK0hZQjFBNCtURURpYzFyMm1cblB3SURBUUFCXG4tLS0tLUVORCBQVUJMSUMgS0VZLS0tLS0iLCJrb250cm9sVVJMIjoiaHR0cDovLzUyLjIwLjIxLjE1NDo4MDkwL2tvbnRyb2wva2l0ZSJ9.grjc4eM1vKY3P113axTb1Bex209pIylMfIPj19A6QlmxbJGut0_xxE_Lj2D9fBsEGIH-_w2zYZ6HWT90cx1GLz3xDfd25zWxhV-LLssafsmnKch-wRfQc_JTZcccIuboiLUZ02pO-W-z4kPADttL4GKrzn25aENyK27zVxu7ZdD4OerQUlEajjkj76UoU14d-dQPgndXCmKtNPF_f4VFGRC-DefffV4Vyn4gONhHIgbTMy-VSVVdlXXXejmHMW20_XxlbwoPs8jmfRAUlznNhMQWRSv3AEFjyU87RIXrOK2aSx0yTTQFsZCXfkvUy_X37mr63hA7B3yZcXYQRp6hlQ"}},"koding_account_profile_firstName":{"default":"alex"},"koding_account_profile_hash":{"default":"dc2185ff3e1ec0a932edecffa1ba8073"},"koding_account_profile_lastName":{"default":""},"koding_account_profile_nickname":{"default":"alex"},"koding_group_slug":{"default":"spb"},"koding_group_title":{"default":"spb"},"koding_user_email":{"default":"aionochkin@tula.co"},"koding_user_username":{"default":"alex"}}}